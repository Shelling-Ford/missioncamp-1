{% macro render_cell(cnt, r_cnt, a_cnt) -%}
{% if not cnt == 0 %}
<td>{{ cnt }} / <span style="color:red">{{ r_cnt }} [{{ '%.2f' % (r_cnt / cnt * 100) }} %]</span> / <span style="color:green">{{ a_cnt }} [{{ '%.2f' % ( a_cnt / cnt * 100 ) }} %]</span></td>
{% else %}
<td>{{ cnt }} / <span style="color:red">{{ r_cnt }} [0.00 %]</span> / <span style="color:green">{{ a_cnt }} [0.00 %]</span></td>
{% endif %}
{%- endmacro %}

{% macro render_stat(stat, metrics) -%}
<p>요약</p>
<table class="table1">
  <tr>
  {# 기본 통계 #}
  {% for name in ['전체', '개인', '단체', '남', '여', '개인 남', '개인 여', '단체 남', '단체 여'] %}
    <td><a href="{{ url_for('.member_list') }}?cancel_yn=0{% for key, value in metrics.basic[name] %}&amp;{{ key }}={{ value }}{% endfor %}">{{ name }}</a></td>
    {{ render_cell(*stat.basic[name]) }}
    {% if name in ['전체', '단체', '여', '개인 여'] %}</tr><tr>{% endif %}
  {% endfor %}
  </tr>
</table>
<br/>

{# GROUP BY 통계 #}
{% for name in ['참가유형별', '지부별', '단체별'] %}
{% set stat_group = stat.group_by[name] %}
<p>{{ name }}</p>
<table class="table1">
  {% set i = 0 %}
  <tr>
  {% for row in stat_group[1] %}
    <td>
      <a href="{{ url_for('.member_list') }}?cancel_yn=0&amp;{{ stat_group[0] }}={{ row[0] }}">
      {% if name == '지부별' %}
      {{ row[0]|area_name }}
      {% elif name == '단체별' %}
      {{ row[0]|group_name }}
      {% else %}
      {{ row[0] }}
      {% endif %}
      </a>
    </td>
    {{ render_cell(row[1], row[2], row[3]) }}
    {% set i = i + 1 %}
    {% if i % 4 == 0 %}</tr><tr>{% endif %}
  {% endfor %}
  </tr>
</table>
<br/>
{% endfor %}

{# 가변필드 기준 통계 #}
{% for name in ['캠퍼스별', '전공별', '직업/직군별', '직장별', '인터콥 훈련유형별'] %}
{% if name in stat.membership %}
{% set stat_group = stat.membership[name] %}
<p>{{ name }}</p>
<table class="table1">
  {% set i = 0 %}
  <tr>
  {% for row in stat_group[1] %}
    <td><a href="{{ url_for('.member_list') }}?cancel_yn=0&amp;{{ stat_group[0] }}={{ row[0] }}">{{ row[0] }}</a></td>
    {{ render_cell(row[1], row[2], row[3]) }}
    {% set i = i + 1 %}
    {% if i % 4 == 0 %}</tr><tr>{% endif %}

  {% endfor %}
  </tr>
</table>
<br/>
{% endif %}
{% endfor %}

{# 연령별 통계 #}
<p>연령별</p>
<table class="table1">
  {% for row in stat.ages %}
  <tr>
    <td>{{ row[0] }}</td>
    {{ render_cell(row[1], row[2], row[3]) }}
  </tr>
  {% endfor %}
</table>
<br/>
{%- endmacro %}
